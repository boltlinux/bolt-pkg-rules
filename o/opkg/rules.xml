<?xml version="1.0" encoding="utf-8"?>
<rules>

    <prepare>
    <![CDATA[

export PKG_CONFIG="$BOLT_INSTALL_PREFIX/bin/${BOLT_HOST_TYPE}-pkg-config"

cd "$BOLT_SOURCE_DIR"
bh_autotools_dev_update
autoreconf -vfi

cd "$BOLT_BUILD_DIR"
GPGERR_CONFIG="$BOLT_INSTALL_PREFIX/bin/gpg-error-config" \
"$BOLT_SOURCE_DIR"/configure \
    --prefix="$BOLT_INSTALL_PREFIX" \
    --sysconfdir=/etc \
    --localstatedir=/var \
    --build="$BOLT_BUILD_TYPE" \
    --host="$BOLT_HOST_TYPE" \
    --disable-silent-rules \
    --disable-gpg \
    --disable-openssl \
    --enable-usign \
    --enable-sha256 \
    --enable-curl \
    --enable-ssl-curl \
    --with-libsolv

    ]]>
    </prepare>

    <build>
    <![CDATA[

cd $BOLT_BUILD_DIR
make -j"$BOLT_PARALLEL_JOBS"

    ]]>
    </build>

    <install>
    <![CDATA[

cd "$BOLT_BUILD_DIR"
make DESTDIR="$BOLT_INSTALL_DIR" install

install -d -m 0755 "$BOLT_INSTALL_DIR/$BOLT_INSTALL_PREFIX/include/opkg"
find "$BOLT_SOURCE_DIR/libopkg/" -name "*.h" -exec install -m 644 '{}' \
    "$BOLT_INSTALL_DIR/$BOLT_INSTALL_PREFIX/include/opkg" ';'

rm -f "$BOLT_INSTALL_DIR/$BOLT_INSTALL_PREFIX/bin/opkg-key"
rm -f "$BOLT_INSTALL_DIR/$BOLT_INSTALL_PREFIX/bin/opkg-check-config"

install -m 0755 "$BOLT_SOURCE_DIR/utils/opkg-usign-key" \
	"$BOLT_INSTALL_DIR/$BOLT_INSTALL_PREFIX/bin/opkg-key"

    ]]>
    </install>

</rules>
