<?xml version="1.0" encoding="utf-8"?>
<rules>
    <prepare>
    <![CDATA[

export MACHINE="`echo $BOLT_HOST_TYPE | cut -d'-' -f1`"

for build_type in "shared" "no-shared"; do
    mkdir -p "$BOLT_BUILD_DIR/$build_type"

    cd "$BOLT_BUILD_DIR/$build_type"
    $BOLT_SOURCE_DIR/Configure $build_type \
        --prefix="$BOLT_INSTALL_PREFIX" \
        --cross-compile-prefix="${BOLT_HOST_TYPE}-" \
        --openssldir="$BOLT_INSTALL_PREFIX/lib/ssl" \
        --libdir=lib \
        \
        no-idea no-mdc2 no-rc5 no-zlib no-ssl3 no-ssl3-method \
        no-async enable-rfc3779 enable-cms \
        "linux-$MACHINE"
done

    ]]>
    </prepare>

    <build>
    <![CDATA[

for build_type in "shared" "no-shared"; do
    make -C "$BOLT_BUILD_DIR/$build_type" -j"$BOLT_PARALLEL_JOBS"
done

    ]]>
    </build>

    <install>
    <![CDATA[

make -C "$BOLT_BUILD_DIR/shared" DESTDIR="$BOLT_INSTALL_DIR" install
cp -a "$BOLT_BUILD_DIR/no-shared/"*.a "$BOLT_INSTALL_DIR/$BOLT_INSTALL_PREFIX/lib"

mkdir -p "$BOLT_INSTALL_DIR/etc/ssl"

for item in certs openssl.cnf private; do
    mv "$BOLT_INSTALL_DIR/$BOLT_INSTALL_PREFIX/lib/ssl/$item" "$BOLT_INSTALL_DIR/etc/ssl/"
    ln -s "/etc/ssl/$item" "$BOLT_INSTALL_DIR/$BOLT_INSTALL_PREFIX/lib/ssl/"
done

chmod 0700 "$BOLT_INSTALL_DIR/etc/ssl/private"

    ]]>
    </install>
</rules>
